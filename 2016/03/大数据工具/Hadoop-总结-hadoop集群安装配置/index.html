<!DOCTYPE html><html lang=""><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>hadoop集群安装配置 | CS Learning of CHNwentao</title><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css?version=1.3"><script><!-- hexo-inject:begin --><!-- hexo-inject:end -->var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?js?c4c99183a6a02c53d4760ae1995c3b38";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();</script><script>var GLOBAL = { 
  root: '/',
  algolia: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  localSearch: {"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}"},"path":"search.xml"}
} </script><link rel="icon" href="/favicon.ico"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#准备工作"><span class="toc-number">1.</span> <span class="toc-text">准备工作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#计算机命名"><span class="toc-number">1.1.</span> <span class="toc-text">计算机命名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#网络配置"><span class="toc-number">1.2.</span> <span class="toc-text">网络配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#检查网络配置情况"><span class="toc-number">1.3.</span> <span class="toc-text">检查网络配置情况</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SSH-密钥分发"><span class="toc-number">1.4.</span> <span class="toc-text">SSH 密钥分发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#授权的权限修改（这步可有可无）"><span class="toc-number">1.5.</span> <span class="toc-text">授权的权限修改（这步可有可无）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#shh登录的验证"><span class="toc-number">1.6.</span> <span class="toc-text">shh登录的验证</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置集群-分布式环境"><span class="toc-number">2.</span> <span class="toc-text">配置集群/分布式环境</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#slaves"><span class="toc-number">2.1.</span> <span class="toc-text">slaves</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#文件-core-site-xml-改为下面的配置："><span class="toc-number">2.2.</span> <span class="toc-text">文件 core-site.xml 改为下面的配置：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#文件-hdfs-site-xml-改为下面的配置"><span class="toc-number">2.3.</span> <span class="toc-text">文件 hdfs-site.xml 改为下面的配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#文件-mapred-site-xml-改为下面的配置"><span class="toc-number">2.4.</span> <span class="toc-text">文件 mapred-site.xml 改为下面的配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#文件-yarn-site-xml-改为下面的配置"><span class="toc-number">2.5.</span> <span class="toc-text">文件 yarn-site.xml 改为下面的配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#部署"><span class="toc-number">3.</span> <span class="toc-text">部署</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#启动及问题"><span class="toc-number">4.</span> <span class="toc-text">启动及问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#预备知识"><span class="toc-number">5.</span> <span class="toc-text">预备知识</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="http://7xiuu0.com1.z0.glb.clouddn.com/17-11-23/22222257.jpg"></div><div class="author-info__name text-center">Wente Guo</div><div class="author-info__description text-center">一个学习的博客网站，专注于计算机科学、机器学习、数据挖掘等的 技术分享、相关咨询及经验总结</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">134</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">184</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">19</span></a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container" style="background-image: url(true);"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">CS Learning of CHNwentao</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a><a class="site-page" href="/about">About</a></span></div><div id="post-info"><div id="post-title">hadoop集群安装配置</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2016-03-22</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"> </i><a class="post-meta__categories" href="/categories/hadoop/">hadoop</a><div class="post-meta-wordcount"><span>Word count: </span><span class="word-count">2,020</span><span class="post-meta__separator">|</span><span>Reading time: 8 min</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div id="post-content"><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>Hadoop 集群的安装配置大致为如下流程:</p>
<!-- hexo-inject:begin --><!-- hexo-inject:end --><p>选定一台机器作为 Master<br>在 Master 节点上配置 hadoop 用户、安装 SSH server、安装 Java 环境<br>在 Master 节点上安装 Hadoop，并完成配置<br>在其他 Slave 节点上配置 hadoop 用户、安装 SSH server、安装 Java 环境<br>将 Master 节点上的 /usr/local/hadoop 目录复制到其他 Slave 节点上<br>在 Master 节点上开启 Hadoop<a id="more"></a></p>
<h3 id="计算机命名"><a href="#计算机命名" class="headerlink" title="计算机命名"></a>计算机命名</h3><p>为了便于区分，可以修改各个节点的主机名（在终端标题、命令行中可以看到主机名，以便区分）：<br>Linux 中：<code>sudo vim /etc/hostname</code><br>在osx 中 ： <code>System Preference -&gt; Sharing -&gt; Computer Name</code></p>
<p>修改完成后需要<strong>重启</strong>一下，重启后在终端中才会看到机器名的变化。接下来的教程中请注意区分 Master（WenteMBP） 节点与 Slave 节点的操作。</p>
<h3 id="网络配置"><a href="#网络配置" class="headerlink" title="网络配置"></a>网络配置</h3><p>Linux 中查看节点 IP 地址的命令为 <code>ifconfig</code><br>找到了每个结点对应IP后，然后执行如下命令修改自己所用节点的IP映射：<code>sudo vim /etc/hosts</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># hadoop</span><br><span class="line">10.5.57.180 WenteMBP</span><br><span class="line">10.211.55.14 Slave1</span><br></pre></td></tr></table></figure>
<p>我们在 <code>/etc/hosts</code> 中将该映射关系填写上去即可，如下图所示（一般该文件中只有一个 127.0.0.1，其对应名为 localhost，如果有多余的应删除，特别是不能有 “127.0.0.1 WenteMBP” 这样的记录）.</p>
<p>需要在所有节点上完成网络配置:如上面讲的是 Master(WenteMBP )节点的配置，而在其他的 Slave 节点上，也要对 <code>/etc/hostname</code>（修改为 Slave1、Slave2 等） 和 <code>/etc/hosts</code>（跟 Master 的配置一样）这两个文件进行修改.</p>
<h3 id="检查网络配置情况"><a href="#检查网络配置情况" class="headerlink" title="检查网络配置情况"></a>检查网络配置情况</h3><p>配置好后需要在各个节点上执行如下命令，测试是否相互 ping 得通，如果 ping 不通，后面就无法顺利配置成功：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ping WenteMBP -c 3   # 只ping 3次，否则要按 Ctrl+c 中断</span><br><span class="line">ping Slave1 -c 3</span><br></pre></td></tr></table></figure>
<h3 id="SSH-密钥分发"><a href="#SSH-密钥分发" class="headerlink" title="SSH 密钥分发"></a>SSH 密钥分发</h3><p>这个是很容易出错的地方，这个<strong>授权是相互的</strong>!</p>
<p>这个操作是要让 Master 节点可以无密码 SSH 登陆到各个 Slave 节点上。</p>
<p>首先生成 Master 节点的公匙，在 Master 节点的终端中执行（因为改过主机名，所以还需要删掉原有的再重新生成一次）：<a href="">具体操作请看上一篇blog</a></p>
<p>完成后可执行 <code>ssh WenteMBP</code> 验证一下（可能需要输入 yes，成功后执行 exit 返回原来的终端）。接着在 WenteMBP 节点将上公匙传输到 Slave1 节点：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp ~/.ssh/id_rsa.pub wente@Slave1:/home/hadoop/</span><br></pre></td></tr></table></figure>
<p>接着在 Slave1 节点上，将 ssh 公匙加入授权：</p>
<p><code>cat /media/psf/LinuxShar/authorized_keys\ copy  &gt;&gt; ~/.ssh/authorized_keys</code>（我的是id_rsa.pub 是放在虚拟机共享盘中的，源地址和别人的可能不一样.）</p>
<p>同理，将Slave1的公钥授权给WenteMBP!</p>
<h3 id="授权的权限修改（这步可有可无）"><a href="#授权的权限修改（这步可有可无）" class="headerlink" title="授权的权限修改（这步可有可无）"></a>授权的权限修改（这步可有可无）</h3><p>在验证前，需要做两件事儿。第一件事儿是修改文件”<code>authorized_keys</code>“权限（权限的设置非常重要，因为不安全的设置安全设置，会让你不能使用RSA功能），另一件事儿是用root用户设置”<code>/etc/ssh/sshd_config</code>“的内容。使其无密码登录有效。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/ssh/sshd_config</span><br><span class="line"></span><br><span class="line">RSAAuthentication yes</span><br><span class="line"></span><br><span class="line">PubkeyAuthentication yes</span><br><span class="line"></span><br><span class="line">AuthorizedKeysFile    .ssh/authorized_keys</span><br></pre></td></tr></table></figure></p>
<p>然后再通过chmod命令给该文件赋值权限<br><code>chmod 600 authorized_keys</code></p>
<h3 id="shh登录的验证"><a href="#shh登录的验证" class="headerlink" title="shh登录的验证"></a>shh登录的验证</h3><p>这样，在 Master 节点上就可以无密码 SSH 到各个 Slave 节点了，可在 Master 节点上执行如下命令进行检验，如下图所示：</p>
<p><code>ssh Slave1</code></p>
<p>如果出现以下错误提示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span><br><span class="line">@       WARNING: POSSIBLE DNS SPOOFING DETECTED!          @</span><br><span class="line">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span><br><span class="line">The ECDSA host key for slave1 has changed,</span><br><span class="line">and the key for the corresponding IP address 10.211.55.14</span><br><span class="line">is unchanged. This could either mean that</span><br><span class="line">DNS SPOOFING is happening or the IP address for the host</span><br><span class="line">and its host key have changed at the same time.</span><br><span class="line">Offending key for IP in /Users/wente/.ssh/known_hosts:11</span><br><span class="line">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span><br><span class="line">@    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @</span><br><span class="line">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span><br><span class="line">IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!</span><br><span class="line">Someone could be eavesdropping on you right now (man-in-the-middle attack)!</span><br><span class="line">It is also possible that a host key has just been changed.</span><br><span class="line">The fingerprint for the ECDSA key sent by the remote host is</span><br><span class="line">SHA256:S9EhCzYP0GlDf+Rj5Ke+a2iDiY1vZjn4w8jlDtFyEn0.</span><br><span class="line">Please contact your system administrator.</span><br><span class="line">Add correct host key in /Users/wente/.ssh/known_hosts to get rid of this message.</span><br><span class="line">Offending ECDSA key in /Users/wente/.ssh/known_hosts:9</span><br><span class="line">ECDSA host key for slave1 has changed and you have requested strict checking.</span><br><span class="line">Host key verification failed.</span><br><span class="line">lost connection</span><br></pre></td></tr></table></figure>
<p>那就删除<code>/.ssh/known_hosts</code>中slave1相关的条目就可以了。</p>
<h2 id="配置集群-分布式环境"><a href="#配置集群-分布式环境" class="headerlink" title="配置集群/分布式环境"></a>配置集群/分布式环境</h2><p>集群/分布式模式需要修改<code>/usr/local/hadoop/etc/hadoop</code> 中的5个配置文件。<br>正常启动所必须的设置项： <code>slaves、core-site.xml、hdfs-site.xml、mapred-site.xml、yarn-site.xml</code>。</p>
<h3 id="slaves"><a href="#slaves" class="headerlink" title="slaves"></a>slaves</h3><p>将作为 DataNode 的主机名写入该文件，每行一个，默认为 localhost，所以在伪分布式配置时，节点即作为 NameNode 也作为 DataNode。分布式配置可以保留 localhost，也可以删掉，让 Master 节点仅作为 NameNode 使用。</p>
<h3 id="文件-core-site-xml-改为下面的配置："><a href="#文件-core-site-xml-改为下面的配置：" class="headerlink" title="文件 core-site.xml 改为下面的配置："></a>文件 core-site.xml 改为下面的配置：</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://WenteMBP:9000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.tmp.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>file:/usr/local/hadoop/tmp<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">description</span>&gt;</span>Abase for other temporary directories.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="文件-hdfs-site-xml-改为下面的配置"><a href="#文件-hdfs-site-xml-改为下面的配置" class="headerlink" title="文件 hdfs-site.xml 改为下面的配置"></a>文件 hdfs-site.xml 改为下面的配置</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.secondary.http-address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>WenteMBP:50090<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.name.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>file:/usr/local/hadoop/tmp/dfs/name<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.datanode.data.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>file:/usr/local/hadoop/tmp/dfs/data<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="文件-mapred-site-xml-改为下面的配置"><a href="#文件-mapred-site-xml-改为下面的配置" class="headerlink" title="文件 mapred-site.xml 改为下面的配置"></a>文件 mapred-site.xml 改为下面的配置</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.framework.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>yarn<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.jobhistory.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>WenteMBP:10020<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.jobhistory.webapp.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>WenteMBP:19888<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="文件-yarn-site-xml-改为下面的配置"><a href="#文件-yarn-site-xml-改为下面的配置" class="headerlink" title="文件 yarn-site.xml 改为下面的配置"></a>文件 yarn-site.xml 改为下面的配置</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Site specific YARN configuration properties --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.hostname<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>WenteMBP<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>mapreduce_shuffle<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h2><p>配置好后，将 Master 上的 /usr/local/Hadoop 文件夹复制到各个节点上就可以了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/</span><br><span class="line">tar -zcf ~/hadoop.master.tar.gz ./hadoop # 先压缩再复制</span><br><span class="line">cd ~</span><br><span class="line">scp ./hadoop.master.tar.gz Slave1:/home/wente</span><br></pre></td></tr></table></figure></p>
<p>因为之前有跑过伪分布式模式，建议在切换到集群模式前先删除之前的临时文件。在 Master(WenteMBP) 节点上执行：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local</span><br><span class="line">sudo rm -r ./hadoop/tmp     # 删除 Hadoop 临时文件</span><br><span class="line">sudo rm -r ./hadoop/logs/*   # 删除日志文件</span><br><span class="line">tar -zcf ~/hadoop.master.tar.gz ./hadoop   # 先压缩再复制</span><br><span class="line">cd ~</span><br><span class="line">scp ./hadoop.master.tar.gz Slave1:/home/wente</span><br></pre></td></tr></table></figure>
<p>在 Slave1 节点上执行：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo rm -r /usr/local/hadoop    # 删掉旧的（如果存在）</span><br><span class="line">sudo tar -zxf ~/hadoop.master.tar.gz -C /usr/local</span><br><span class="line">sudo chown -R wente:wente /usr/local/hadoop  #这步很重要，不设置的话，master无法调用</span><br></pre></td></tr></table></figure>
<h2 id="启动及问题"><a href="#启动及问题" class="headerlink" title="启动及问题"></a>启动及问题</h2><p>首次启动需要先在 Master(WenteMBP) 节点执行 NameNode 的格式化：<code>hdfs namenode -format</code></p>
<p>接着可以启动 hadoop 了，启动需要在 Master(WenteMBP) 节点上进行：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">start-all.sh</span><br><span class="line">mr-jobhistory-daemon.sh start historyserver</span><br></pre></td></tr></table></figure>
<p>通过命令 <code>jps</code>可以查看各个节点所启动的进程。正确的话，在 Master 节点上可以看到如下所示(数字 不一样，注意进程)：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">10352 NameNode</span><br><span class="line">10802 NodeManager</span><br><span class="line">10451 DataNode</span><br><span class="line">10569 SecondaryNameNode</span><br><span class="line">10700 ResourceManager</span><br><span class="line">10862 Jps</span><br><span class="line">9630 JobHistoryServer</span><br></pre></td></tr></table></figure>
<p>在 Slave 节点可以看到 DataNode 和 NodeManager 进程，如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wente@Slave1:~$ jps</span><br><span class="line">23992 DataNode</span><br><span class="line">24168 NodeManager</span><br><span class="line">24987 Jps</span><br></pre></td></tr></table></figure>
<p>缺少任一进程都表示出错。另外还需要在 Master 节点上通过命令<code>hdfs dfsadmin -report</code> 查看 DataNode 是否正常启动，如果 Live datanodes 不为 0 ，则说明集群启动成功。</p>
<p>也可以通过 Web 页面看到查看 DataNode 和 NameNode 的状态：<a href="http://wenteMBP:50070/" target="_blank" rel="noopener">http://wenteMBP:50070/</a>。如果不成功，可以通过启动日志排查原因。</p>
<h2 id="预备知识"><a href="#预备知识" class="headerlink" title="预备知识"></a>预备知识</h2><p>Shell 命令<br>scp 是 secure copy 的简写，用于在 Linux 下进行远程拷贝文件，类似于 cp 命令，不过 cp 只能在本机中拷贝。执行 scp 时会要求输入 Slave1 上 hadoop 用户的密码(hadoop)，输入完成后会提示传输完毕.</p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info">Wente Guo</span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info">http://chnwentao.com/2016/03/大数据工具/Hadoop-总结-hadoop集群安装配置/</span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" target="_blank">CC BY-NC-SA 3.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/集群/">集群</a><a class="post-meta__tags" href="/tags/linux/">linux</a><a class="post-meta__tags" href="/tags/配置/">配置</a><a class="post-meta__tags" href="/tags/安装/">安装</a><a class="post-meta__tags" href="/tags/hadoop/">hadoop</a></div></article><nav id="pagination"><div class="prev-post pull-left"><a href="/2016/03/coding/基础_算法/Algorithms-笔记-无向图/"><i class="fa fa-chevron-left">  </i><span>Algorithms-笔记-无向图性质及实现</span></a></div><div class="next-post pull-right"><a href="/2016/03/大数据工具/Hadoop-总结- Hadoop-Eclipse-Plugin 安装配置/"><span>Eclipse安装Hadoop-Eclipse-Plugin</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">©2015 - 2017 By Wente Guo</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="/js/third-party/anime.min.js"></script><script src="/js/third-party/jquery.min.js"></script><script src="/js/third-party/jquery.fancybox.min.js"></script><script src="/js/third-party/velocity.min.js"></script><script src="/js/third-party/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.3"></script><script src="/js/fancybox.js?version=1.3"></script><script src="/js/sidebar.js?version=1.3"></script><script src="/js/copy.js?version=1.3"></script><script src="/js/fireworks.js?version=1.3"></script><script src="/js/transition.js?version=1.3"></script><script src="/js/scroll.js?version=1.3"></script><script src="/js/head.js?version=1.3"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  }
});
</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for (i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});
</script><script src="https://cdn.bootcss.com/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end --></body></html>